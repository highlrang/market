<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="https://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorator="layout/basic">

<th:block layout:fragment="script">
    <script src="//t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>
    <script src="/js/address.js"></script>
    <script src="/js/order.js"></script>
    <script>
        $(function(){
            $("#address_checkbox").click(function(){
                if($("input:checkbox[id='address_checkbox']").prop("checked")){
                    $("label[for='address_checkbox']").text("새 주소지");
                    $("#new_address_setting").css("display", "block");
                    $("#existing_address").css("display", "none");

                }else{
                    $("label[for='address_checkbox']").text("기존 주소지");
                    $("#existing_address").css("display", "block");
                    $("#new_address_setting").css("display", "none");
                }
            });
        });
    </script>
</th:block>

<div layout:fragment="content">
    <form action="/order/payment/ready" method="post">
        <input type="hidden" id="customer_id" name="customer_id" th:value="${session.customer.id}">

        <div th:if="${session.order} == 'direct'">
            <input type="hidden" name="item_id" th:value="${item_id}">
        </div>
        <div th:if="${session.order} == 'cart'">
            <input type="hidden" name="cart_id" th:value="${session.customer.cartId}">
        </div>

        <div>
            <div th:object="${order}">
                <div>
                    <input type="hidden" name="order_id" th:value="*{id}">
                </div>
                <div th:each="orderItem : ${order.orderItems}">
                    <div>
                        <input type="text" th:value="${orderItem.name}">
                        <input type="text" th:value="${orderItem.price}">
                        <input type="text" th:value="${orderItem.count}">
                        <span th:if="${orderItem.coupon != null}">
                            <input type="text" th:value="${orderItem.coupon.name}">
                        </span>
                    </div>
                </div>
                <div>
                    <input type="text" th:value="|주문 전체 금액 *{totalPrice}원|">
                </div>
            </div>
        </div>

        <div>
            <label for="address_checkbox">새 주소지</label>
            <input type="checkbox" id="address_checkbox" name="address_checkbox" checked>
        </div>

        <div id="existing_address" style="display:none">
            <span th:object="${session.customer.address}">
                <input type="text" th:value="|우편번호 *{postCode}|">
                <input type="text" th:value="|주소 *{address} *{detailAddress} (*{extraAddress})|">
            </span>
        </div>

        <div id="new_address_setting" style="display:block">
            <input type="text" id="postcode" name="post_code" placeholder="우편번호">
            <input type="button" onclick="execDaumPostcode()" value="우편번호 찾기"><br>
            <input type="text" id="address" name="address" placeholder="주소"><br>
            <input type="text" id="detailAddress" name="detail_address" placeholder="상세주소">
            <input type="text" id="extraAddress" name="extra_address" placeholder="참고항목">
            <input type="button" id="address-save" value="내 주소지로 저장">
        </div>

        <input type="submit" value="결제하기">
    </form>

</div>